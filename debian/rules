#!/usr/bin/make -f

# Split this up a bit to avoid long lines
CONFIGURE_GDA_PATH = /usr/share/gnome-control-center/default-apps
CONFIGURE_GDA = --with-gnome-default-applications=$(CONFIGURE_GDA_PATH)
CONFIGURE_COMMON = $(CONFIGURE_GDA) CFLAGS="-Wl,--as-needed -Wall"

%:
	dh $@

override_dh_auto_configure:
	dh_auto_configure -proxterm-gtk2 --builddirectory=build-gtk2 \
		-- --disable-gtk3 $(CONFIGURE_COMMON)
	dh_auto_configure -proxterm-common -proxterm \
		-- --enable-gtk3 $(CONFIGURE_COMMON)

override_dh_auto_build:
	dh_auto_build -proxterm-gtk2 --parallel --builddirectory=build-gtk2
	dh_auto_build -proxterm-common -proxterm --parallel

override_dh_auto_install:
	dh_auto_install --builddirectory=build-gtk2 -proxterm-gtk2 --autodest
	dh_auto_install -proxterm-common -proxterm --autodest
	install -d debian/roxterm-gtk2/usr/share/applications/
	install -m 0644 roxterm.desktop \
		debian/roxterm-gtk2/usr/share/applications/
	install -d debian/roxterm-common/usr/share/pixmaps/
	install -m 0644 debian/roxterm.xpm \
		debian/roxterm-common/usr/share/pixmaps/
	# The following dh_install copies everything into package's tmp!
	#dh_install -proxterm-common --sourcedir=debian \
	#	roxterm.xpm /usr/share/pixmaps/

override_dh_auto_test:
	dh_auto_test -proxterm-gtk2 --builddirectory=build-gtk2
	dh_auto_test -proxterm-common -proxterm

override_dh_auto_clean:
	dh_auto_clean
	rm -rf build-gtk2
